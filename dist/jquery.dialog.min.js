/*
* jqDialog - jQuery plugin for creating dialog hovering div
*
* Version: 0.0.1
* Build: 31
* Copyright 2011 Alex Tkachev
*
* Dual licensed under MIT or GPLv2 licenses
*   http://en.wikipedia.org/wiki/MIT_License
*   http://en.wikipedia.org/wiki/GNU_General_Public_License
*
* Date: 03 Jan 2012 00:50:18
*/

(function(a){a.dialog={},a.dialog.i18n=a.i18n(),a.dialog.defaults={type:"simple",content:"",position:{my:"left top",at:"left bottom"},events:{},buttons:{},toolbar:[]},a.dialog.types={}})(jQuery),function(a){var b=function(){this.initialize.apply(this,arguments)};a.extend(b.prototype,{initialize:function(){},_createButtons:function(b){var c=this,d=a("div.toolbar",this.el).html("");for(var e=0;e<b.toolbar.length;e++){var f=b.toolbar[e],g=this.options.buttons[f];g.name=f;var h=a('<a href="javascript:;"/>').addClass(g.cls).html(g.text||a.dialog.i18n.t("buttons."+g.name));d.append(h),h.click(function(a){c._onButtonClick(f)})}},_onButtonClick:function(b){var c=this.options.buttons[b];c.keepVisible||a.dialog.hide();var d=this._dialogReturnData(c.name,event);c.action&&c.action(d),this._invokeCallback(c.name,event,d),this._invokeCallback("buttonClick",c.name,event,d)},show:function(b){this.options=b,this.el||(this.el=this._createUI()),this._createButtons(b),this.el.show(),a("div.content",this.el).html(b.type.render(this)),a("div.container",this.el).attr("class","container "+b.clsType),this.reposition(),a(document).bind("mousedown",{dialog:this},this._onDocumntMouseDown),this.el.bind("keydown",{dialog:this},this._onDialogKeyDown),this._invokeCallback("show"),this.options.type.onShow&&this.options.type.onShow()},hide:function(){a(document).unbind("mousedown",this._onDocumntMouseDown),this.el.unbind("keydown",this._onDialogKeyDown),this.el.hide(),this._invokeCallback("hide"),this.options.type.onHide&&this.options.type.onHide()},reposition:function(){var b=this.options,c=b.position.my,d=b.position.at;b.position.of.css("direction")=="rtl"&&(c=c.replace("right","_l").replace("left","_r").replace("_l","left").replace("_r","right"),d=d.replace("right","_l").replace("left","_r").replace("_l","left").replace("_r","right"));var e=a("div.tip",this.el),f=c.indexOf("bottom")>=0;e.toggleClass("above",f).toggleClass("below",!f);var g=d.indexOf("right")>=0;b.position.offset="0 "+(f?-e.height():e.height()),this.el.position({my:c,at:d,of:b.position.of,offset:b.position.offset}),e.position({my:d,at:c,of:a("div.container",this.el),offset:(g?-e.width():e.width())+" 0"})},_createUI:function(){return a('<div class="dialog-container"><div class="tip"/><div class="container"><div class="content"/><div class="toolbar"/></div></div>').appendTo("body").hide()},_invokeCallback:function(b){var c=this.options.events[b];a.isFunction(c)&&c.apply(this.options.events.context||this,Array.prototype.slice.call(arguments,1)),a.isFunction(this.options.events.callback)&&this.options.events.callback.apply(this.options.events.context||this,Array.prototype.slice.call(arguments,1))},_dialogReturnData:function(a){return this.options.type.returnData?this.options.type.returnData(a):undefined},_onDocumntMouseDown:function(b){var c=a(b.target);c.closest("div.dialog-container").length===0&&b.data.dialog.hide()},_onDialogKeyDown:function(a){var b=a.data.dialog,c=a.which,d=Object.keys(b.options.buttons).select(function(a){return b.options.buttons[a].keyCode==c}).first();d&&(b._onButtonClick(d),a.stopEvent())}});var c=new b;a.extend(a.dialog,{el:function(){return c.el},show:function(b){b=a.extend({type:a.dialog.defaults.type},b||{});var d=a.dialog.types[b.type];if(!a.isFunction(d))throw"unknown dialog type "+d;b=a.extend(!0,{},a.dialog.defaults,d.defaults||{},b,{type:new d(c)}),c.show(b)},hide:function(){c.hide()}})}(jQuery),function(a){var b=function(){this.initialize.apply(this,arguments)};b.defaults={clsType:"simple",buttons:{close:{keyCode:a.Event.Keys.ESC}},toolbar:["close"]},a.extend(b.prototype,{initialize:function(){},render:function(a){return a.options.content}}),a.dialog.types.simple=b}(jQuery),function(a){var b=function(){this.initialize.apply(this,arguments)};b.defaults={clsType:"confirm",buttons:{yes:{},no:{keyCode:a.Event.Keys.ESC}},toolbar:["yes","no"]},a.extend(b.prototype,{initialize:function(){},render:function(b){return b.options.content||a.dialog.i18n.t("confirm.message")}}),a.dialog.types.confirm=b}(jQuery)
